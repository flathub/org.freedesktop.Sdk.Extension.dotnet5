app-id: org.freedesktop.Sdk.Extension.dotnet5
branch: "21.08"
runtime: org.freedesktop.Sdk
runtime-version: "21.08"
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
appstream-compose: false
modules:
  - name: libunwind
    rm-configure: true
    build-options:
      cflags: -fcommon
      prefix: /usr/lib/sdk/dotnet5
    cleanup:
      - "/include"
      - "/pkgconfig"
      - "*.a"
      - "*.la"
      - "*ptrace.so*"
      - "*setjmp.so*"
    sources:
      - type: archive
        url: http://download.savannah.nongnu.org/releases/libunwind/libunwind-1.5.0.tar.gz
        sha256: 90337653d92d4a13de590781371c604f9031cdb50520366aa1e3a91e1efb1017
      - type: script
        commands:
          - "autoreconf -sif"
        dest-filename: autogen.sh
  - name: dotnet-sdk
    buildsystem: simple
    build-commands:
      - "mkdir -p /usr/lib/sdk/dotnet5/{bin,lib}"
      - "cp -r * /usr/lib/sdk/dotnet5/lib"
      - "ln -s /usr/lib/sdk/dotnet5/lib/dotnet /usr/lib/sdk/dotnet5/bin/dotnet"
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://download.visualstudio.microsoft.com/download/pr/13b9d84c-a35b-4ffe-8f62-447a01403d64/1f9ae31daa0f7d98513e7551246899f2/dotnet-sdk-5.0.400-linux-x64.tar.gz
        sha512: 4d1a92e0885ade03de0fdb41c27cfd948ab749a2f3e686c4a9dee314888c19d76efa6f8663a7aa7eb56cf36f508638c1a1f01c845d1acb19d8662d6ae365d572
      - type: archive
        only-arches: [arm]
        url: https://download.visualstudio.microsoft.com/download/pr/70bdb5a9-34cc-4f28-aa33-15535f73b593/7d31d53187c8937206bcc3b117b88978/dotnet-sdk-5.0.400-linux-arm.tar.gz
        sha512: 432802c0a37fcc005bac98f7a363ff1484f3c0721c5202c9ed7761e1ae0d8b8496fe7be09a640da55c34bceb9eb63dfe509c5397cbc7afd44cc84ad4bf9f5e16
      - type: archive
        only-arches: [aarch64]
        url: https://download.visualstudio.microsoft.com/download/pr/4d323232-ffcc-4c09-a043-a36b554c883e/096822e81dc29383b649cd015d1ff99a/dotnet-sdk-5.0.400-linux-arm64.tar.gz
        sha512: de0cf29ba176529c142c7538ce557b8af1ca978abe3cc6e079ed9cbc8adc41779ad7e28ed519b37e9b16f54381d94fd7842572b3629d65f5494f1ce7bb2a3810

  - name: scripts
    buildsystem: simple
    build-commands:
      - "mkdir -p /usr/lib/sdk/dotnet5/share/appdata"
      - "cp install.sh install-sdk.sh /usr/lib/sdk/dotnet5/bin"
      - "cp org.freedesktop.Sdk.Extension.dotnet5.appdata.xml ${FLATPAK_DEST}/share/appdata"
      - "appstream-compose --basename=org.freedesktop.Sdk.Extension.dotnet5 --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.dotnet5"
    sources:
      - type: script
        commands:
          - "mkdir -p /app/lib/dotnet"
          - "mkdir -p /app/bin"
          - "cp -L /usr/lib/sdk/dotnet5/lib/libunwind{,-coredump,-$FLATPAK_ARCH}.so /app/lib/dotnet"
          - "cp -r /usr/lib/sdk/dotnet5/lib/{dotnet,host,shared} /app/lib/dotnet"
          - "ln -sf /app/lib/dotnet/dotnet /app/bin/dotnet"
        dest-filename: install.sh
      - type: script
        commands:
          - "/usr/lib/sdk/dotnet5/bin/install.sh"
          - "cp -r /usr/lib/sdk/dotnet5/lib/sdk /app/lib/dotnet"
        dest-filename: install-sdk.sh
      - type: file
        path: org.freedesktop.Sdk.Extension.dotnet5.appdata.xml
